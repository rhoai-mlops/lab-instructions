## üêô ArgoCD - GitOps Controller 
GitOps can be seen as a developer-centric approach to Ops. It teaches developers good practices around taking ownership of code once it leaves their machines and the approach to deploying and monitoring this code once it‚Äôs running.

From Argo CD's website, it is described as a tool that:

<div class="highlight" style="background: #f7f7f7">
<pre>
    Automates the deployment of the desired application states in the specified target
    environments. Application deployments can track updates to branches, tags, or be pinned
    to a specific version of manifests at a Git commit.
</pre></div>

When something is seen as not matching the required state in Git, an application becomes out of sync. Depending on how you have implemented your GitOps, Argo CD can then resync the changes to apply whatever is in Git immediately or fire a warning to initiate some other workflow. In the world of Continuous Delivery as implemented by Argo CD, Git is the single source of truth, so we should always apply the changes as seen there.

### Argo CD Applications
Argo CD is one of the most popular GitOps tools. It keeps the state of our OpenShift applications synchronized with our git repos. It is a controller that reconciles what is stored in our git repo (desired state) against what is live in our cluster (actual state). 

We will use Argo CD to deploy our MLOps toolings and models in a repeatable and reproduceable manner. We will store the definitions in Git, and let Argo CD to apply the definitions. That means, we need to deal with some YAML files :) Let's switch to a different type of workbench: `code-server` (let's be honest, Jupyter Notebook is not the best when it comes to YAML and commandline utilitiesü•≤) and create a new workbench next to the existing Jupyter Notebook workbench in our `<USER_NAME>` project.

1. Go to OpenShift AI > `USER_NAME` >  Workbenches and click `Create workbench`

  Select a name you want, could be something like `mlops-gitops` 

    For Notebook Image: 

    - Image selection: `code-server`

    - Deployment size: `Small`

    Leave the rest default and hit `Create`.
  
  When it is in running state, Open it and use your credentials to access it.

  ![codeserver-wb.png](./images/codeserver-wb.png)

2. Open a new terminal by hitting the hamburger menu on top left then select `Terminal` > `New Terminal` from the menu.

   ![code-server-terminal.png](./images/code-server-terminal.png)

3. An Argo CD instance is already installed to your `<USER_NAME>-mlops` environment. Let's verify that it is running and login to Argo CD UI.

Log in to OpenShift by using your credentials:

```bash
  export CLUSTER_DOMAIN=<CLUSTER_DOMAIN>
  oc login --server=https://api.${CLUSTER_DOMAIN##apps.}:6443 -u <USER_NAME> -p <PASSWORD>
```

Then check if Argo CD pods are alive:

  ```bash
  oc get pods -n <USER_NAME>-mlops
  ```

  ![argocd-running.png](./images/argocd-running.png)


4. When all the pods are up and running, we can login to the UI of ArgoCD. Get the route and open it in a new browser tab.

  ```bash
  echo https://$(oc get route argocd-server --template='{{ .spec.host }}' -n <USER_NAME>-mlops)
  ```

5. Login to Argo CD by clicking `Log in via OpenShift` and use the OpenShift credentials provided.

  ![argocd-login.png](./images/argocd-login.png)

6. Select `Allow selected permissions` for the initial login.

8. You just logged into ArgoCD üëèüëèüëè! Lets deploy a sample application through the UI. It'll be just to give you a taste of Argo CD's magic before we use it for our MLOps reasons. On ArgoCD - click `CREATE APPLICATION`. You should see an empty form. Let's fill it out by setting the following:
   * On the "GENERAL" box
      * Application Name: `todolist`
      * Project: `default`
      * Sync Policy: `Automatic`
   * On the "SOURCE" box
      * Repository URL: `https://rht-labs.com/todolist/`
      * Select `Helm` from the right drop down menu
      * Chart: `todolist`
      * Version: `1.1.0`
   * On the "DESTINATION" box
      * Cluster URL: `https://kubernetes.default.svc`
      * Namespace: `<USER_NAME>-mlops`
   * On the "HELM" box
      * Values Files: `values.yaml`

    Your form should look like this:
    ![argocd-create-application](images/argocd-create-application.png)

9. After you hit create, you‚Äôll see `todolist` application is created and should start deploying in your `<USER_NAME>-mlops` namespace.

  ![argocd-todolist-1.png](./images/argocd-todolist-1.png)

10. If you drill down into the application you will get Argo CD‚Äôs amazing view of all of the k8s resources that were generated by the chart.

  ![argocd-todolist-2.png](./images/argocd-todolist-2.png)

11. You can verify the little ToDoList Application is running and behaving as expected by navigating to the url of the app:

    ```bash
    echo https://$(oc get route/todolist -n <USER_NAME>-mlops --template='{{.spec.host}}')
    ```

ü™Ñü™Ñ Magic! You not have a GitOps controller - Argo CD and got it to manually deploy an application for you. Next up, we‚Äôll make Argo CD do some more GitOps ü™Ñü™Ñ



